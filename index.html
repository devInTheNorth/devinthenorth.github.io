<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="2do.css">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.css">
    <title>Qwikly To-do App</title>
</head>
<body data-me="abcde">
    <header>
        <h1>Qwikly To-do App</h1>
        <h2>Why people are using Qwikly</h2>
        <h3>It's: </h3>
        <ol class="features">
            <li>Fast</li>
            <li>Reliable</li>
            <li>Responsive</li>
            <li>Easy To Use</li>
        </ol>

    </header>
    <div class="container">
    <main class="main">
        
            <form id="todo-form">
            <legend><h2>Add a new To-do</h2></legend>
            <label for="txtHeading">Add a Title</label>
             <p><input type="text" name="txtHeading" id="txtHeading" placeholder=" Add a Title" required> </p>

             <p> <label for="txtDate">Select A Date</label> <label for="txtTime" style="margin-left: 130px;">Supply Time</label> </p>
            <input type="date" name="txtDate" id="txtDate" placeholder=" Pick a Date" required> 

             <input type="time"  name="txtTime" id="txtTime" required >

             
             <p style="clear: both;">
                <label for="txtDetails">Add More Details</label>
                
                <textarea cols="30" name="txtDetails" id="txtDetails" rows="10" placeholder=" Add more Details" required></textarea> </p>
             <p class="withIcon"><input type="submit" value="Add To List" id="btnAdd" class="btn"> 
                <i class="fa fa-2x fa-plus"></i>
            </p>
            <p class="withIcon" id="pupdate" style="display: none;">
                <input type="submit" value="Update Task" id="btnUp" class="btn"> 
                <i class="fa fa-2x fa-save"></i>
            </p>
            <p class="withIcon"><input type="button" value="Autofill" id="btnAuto" class="btn"> 
                
                
            
            </p>
            </form>
       
    </main>
    <aside>
        
        
        <div class="tasks">
            <h2>Active Tasks</h2>
            <i class="fa fab fa-expand " id="btn2m"></i>
            <div class="table" id="tasks-2m" style="display: none;" >
               
            </div>
            
        </div>
        

    </aside>
    </div>
    <div>


    </div>
    <footer>
        <h2>Developed with <i class="fa fa-3x fa-heart-o anim-heart"></i> by<a href="https://www.github.com/DevInTheNorth"> DevInTheNorth <a/></h2>
       

    </footer>
   
<!-- popup box -->

        <div id="Popup" class="Popup">

        
        <div class="Popup-content">
            <span class="close">&times;</span>
            <h2>Successful!!!</h2>
            <p id="msg">your Task has been successfully <span class="placeholder"></span> </p>
        </div>

        </div>
   
    <script>
        let currentKey = '';
        let currentOp = 'A';
         window.addEventListener('load', () => {
           // fetchItems("#tasks-2m");
            //document.querySelector('.btnDelete').addEventListener('click', () => {
           // alert('okagvg');
            initButtons();
           
        }); 

        function initButtons(){
            let delBtns = document.querySelectorAll('.btnDelete');
            for (let x of delBtns){
                x.addEventListener('click', () => {
                    let delKey = x.getAttribute('data-key');
                document.querySelector(`div[data-taskid='${x.getAttribute('data-key')}']`).style.display = 'none';
                localStorage.removeItem(delKey);
                document.querySelector('.placeholder').innerHTML = 'Deleted !';
                document.querySelector('.Popup-content').style.backgroundColor = 'salmon';
                document.querySelector('#Popup').style.display = 'block';
                //let m= document.querySelector(`div[deata-taskid='Todo-3']`)
                    
                });
            }
            let editBns = document.querySelectorAll('.btnEdit');
            for (let m of editBns){
                m.addEventListener('click', () => {
                    currentOp = "B";
                    currentKey = m.getAttribute('data-key');
                    let Div = document.querySelector(`div[data-taskid='${m.getAttribute('data-key')}']`);
                    fillForm(Div);
                    document.querySelector('#btnAdd').style.display = 'none';
                    document.querySelector('#pupdate').style.display = 'block';                    
                });

            }

        }
            
    document.querySelector('.close').addEventListener('click', ()=> {
        document.querySelector('#Popup').style.display = "none";
    })
        //})
        let TodoObj = new Object();
        function fillForm(dataKey){
            document.querySelector('#txtHeading').value = dataKey.querySelector('.todo-title').textContent;
                document.querySelector('#txtDate').value = dataKey.querySelector('.todo-date').textContent.trim();
               document.querySelector('#txtTime').value  =  dataKey.querySelector('.todo-time').textContent.trim();
            
              // let dDate =new Date(dataKey.querySelector('.todo-time').textContent).toDateString('');
               
               
                document.querySelector('#txtDetails').value = dataKey.querySelector('.todo-details').textContent; 
        }

        function collapseList(listID, ctrlBtn){
            document.querySelector(listID).style.display = 'none';
            document.querySelector(listID).innerHTML = '';
               document.querySelector(ctrlBtn).classList.remove('fa-minus');
               document.querySelector(ctrlBtn).classList.add('fa-expand');

        }
        function expandList(listID, ctrlBtn){
            fetchItems(listID);
            initButtons();
        document.querySelector(listID).style.display = 'block';
            document.querySelector(ctrlBtn).classList.remove('fa-expand');
            document.querySelector(ctrlBtn).classList.add('fa-minus');

     } 
        let btn2m = document.querySelector('#btn2m').addEventListener('click', () => {
            
            
            if(document.querySelector('#btn2m').className.includes('fa-expand')){
                
               expandList('#tasks-2m', "#btn2m"); 
              }
           else{ collapseList('#tasks-2m', "#btn2m"); }
            
        });

            function fetchItems(tasksListID){
                /* for(let i =2; i<localStorage.length; i++) {
                    let Item = JSON.parse(localStorage[`Todo-${i}`]);
                    let con =  `<h2> ${Item.Title} </h2> <td> ${Item.Title} </td<td> ${Item.Title} </td<td> ${Item.Title} </td` 
                
                  
                } */
                for (els of Object.keys(localStorage)){
                    elContent = JSON.parse(localStorage.getItem(els));
                    let con1 =  `<div class='todo-item' data-taskID='${els}'> <h3 class='todo-title'> ${elContent.Title} </h3>`+
                    `<strong> Date: </strong>  <span class='todo-date'>  ${elContent.Date} </span> <strong>Time: </strong>`+ 
                    `<span  class='todo-time'> ${elContent.Time} </span>`;

                    con2 = `<p><strong>Details: </strong> <span class='todo-details'>`+
                    `${elContent.Details} </span><p>  `+
                    `<button class='btnDelete' data-key='${els}'> Delete </button> <button class='btnEdit' data-key='${els}'>`+
                    `Edit </button> </div>`; 
                    document.querySelector(tasksListID).innerHTML += con1 + con2 ;
                    
                }

            }
            
       /*  (btn2m.className.includes('fa-expand')) ? collapseList('#tb2m', btn2m) : expandList('#tb2m', btn2m); */
          
            function  AddToDo(TodoObj){
                
                console.log('adding Objs')
                    let storageNum = `Todo-${genID(localStorage.length+1)}`;
               // (localStorage.length)
               
                 localStorage.setItem(storageNum, JSON.stringify(TodoObj));
                 
            }
            let btnUpdate = document.querySelector('#btnUp').addEventListener('click', ()=> {
                    updateTodo(getInputs(), currentKey);
                    document.querySelector('.placeholder').innerHTML = 'Updated !';
                document.querySelector('.Popup-content').style.backgroundColor = '#cccccc';
                document.querySelector('#Popup').style.display = 'block';
                btnUpdate.style.display = 'none';
                document.querySelector('#btnAdd').style.display = 'block';
            });
            function getInputs(){
                TodoObj.Title = document.querySelector('#txtHeading').value;
                TodoObj.Date = document.querySelector('#txtDate').value;
                TodoObj.Time = document.querySelector('#txtTime').value;
                TodoObj.Details = document.querySelector('#txtDetails').value;
                console.log('returing Objs');
                return TodoObj;
            }
            let btnAdd = document.querySelector('#btnAdd').addEventListener('click', () => {
               
                   // document.querySelector('.placeholder').innerHTML = 'message' ;
                    //document.querySelector('#Popup').style.display = 'block';
                    AddToDo(getInputs()); 
                    document.querySelector('.placeholder').innerHTML = 'Added to the Todo-list !';
                document.querySelector('.Popup-content').style.backgroundColor = 'green';
                document.querySelector('#Popup').style.display = 'block';
                           // 
            
                      
                      
            }); 
            function updateTodo(TodoObj, dataKey){
                      
                 localStorage.setItem(dataKey, JSON.stringify(TodoObj));
                 

            }

        /* function validateInputs(textBox, pattern){

        } */
        let btnAuto = document.querySelector('#btnAuto').addEventListener('click', () => {
                document.querySelector('#txtHeading').value = 'Random Heading';
                document.querySelector('#txtDate').value = '1991-02-12';
                document.querySelector('#txtTime').value = '02:05';
                document.querySelector('#txtDetails').value = 'SOME RANDOM VALUES';
        })
        
        function genID(ID){
            if(! (localStorage.getItem("Todo-"+ID ) == null)){
                
                return genID(++ID);
            }
            else {
               return ID;
                
            }
        }
    </script>
</body>
</html>
